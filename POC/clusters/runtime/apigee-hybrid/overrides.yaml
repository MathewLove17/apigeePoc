# ============================================================
# Apigee Hybrid 1.16 - overrides.yaml (basado en plantilla oficial)
# Target: AKS / POC / ArgoCD / External Secrets
# ============================================================

instanceID: poc-apigee-aks
namespace: apigee

gcp:
  projectID: pocapigee-485810
  region: europe-west1

k8sCluster:
  name: clusterapigee
  # En AKS esto es orientativo para analytics/nearest region
  region: westeurope

org: pocapigee-485810

# ------------------------------------------------------------
# Scheduling (AKS)
# Evita el default GKE affinity (cloud.google.com/gke-nodepool)
# y fuerza a correr en el agentpool de AKS
# ------------------------------------------------------------
nodeAffinity:
  requiredForScheduling: true
  key: kubernetes.azure.com/agentpool
  values:
    - agentpool

nodeSelector:
  requiredForScheduling: true   # o false si quieres que “no bloquee”
  apigeeRuntime:
    key: "kubernetes.azure.com/agentpool"
    value: "agentpool"          # <-- aquí el nombre REAL del agentpool donde quieres runtime/operator
  apigeeData:
    key: "kubernetes.azure.com/agentpool"
    value: "agentpool"          # <-- y aquí el agentpool para data (cassandra/redis)




# ------------------------------------------------------------
# Entorno
# ------------------------------------------------------------
envs:
  - name: test
    serviceAccountSecretRefs:
      # En POC puedes usar el mismo secret para todo
      synchronizer: gcp-sa-json
      runtime: gcp-sa-json

# ------------------------------------------------------------
# Cassandra (POC)
# ------------------------------------------------------------
cassandra:
  hostNetwork: false
  replicaCount: 1

# ------------------------------------------------------------
# Ingress Gateways
# ------------------------------------------------------------
ingressGateways:
  - name: hybrid-ingress
    replicaCountMin: 1
    replicaCountMax: 2
    svcAnnotations: {}

# ------------------------------------------------------------
# Virtualhosts (EnvGroup)
# envgroup = hybrid-group (lo que tú ya tienes)
# ------------------------------------------------------------
virtualhosts:
  - name: hybrid-group
    selector:
      app: apigee-ingressgateway
      ingress_name: hybrid-ingress
    sslCertPath: certs/tls.crt
    sslKeyPath: certs/tls.key

# ------------------------------------------------------------
# ServiceAccount secrets (desde ExternalSecrets)
# IMPORTANTE: los secrets deben contener la key: client_secret.json
# ------------------------------------------------------------
guardrails:
  serviceAccountRef: apigee-operator-guardrails-svc-account

mart:
  serviceAccountRef: gcp-sa-json

connectAgent:
  serviceAccountRef: gcp-sa-json

logger:
  enabled: true
  serviceAccountRef: gcp-sa-json

metrics:
  serviceAccountRef: gcp-sa-json

watcher:
  serviceAccountRef: gcp-sa-json

# ------------------------------------------------------------
# Runtime
# ------------------------------------------------------------
runtime:
  image:
    uri: "gcr.io/apigee-release/hybrid/apigee-runtime"
    tag: "1.16.0"
  # sizing POC (si quieres lo ajustamos luego)
  #cwcAppend:
  #  resources:
  #    requests:
  #      memory: 4Gi
  #    limits:
  #      memory: 6Gi
